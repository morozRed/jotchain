<%= turbo_frame_tag dom_id(chain) do %>
  <article class="group rounded-xl mt-4 mb-4 border border-white/10 bg-slate-900/70 transition hover:border-indigo-400/40">
    <div class="flex flex-col gap-4 p-5">
      <%= link_to chain_path(chain), data: { turbo_frame: "_top" }, class: "flex flex-col gap-4" do %>
        <div class="flex items-start justify-between gap-4">
          <div>
            <p class="text-[0.65rem] uppercase tracking-[0.35em] text-slate-500">Chain</p>
            <h3 class="mt-1 text-lg font-semibold text-white"><%= chain.name %></h3>
          </div>
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300/90">
            <%= pluralize(chain.links.count, "note") %>
          </span>
        </div>

      <p class="text-sm leading-6 text-slate-400"><%= chain.summary_sentence %></p>

        <% if (last_note = chain.links.first) %>
          <div class="rounded-lg border border-white/5 bg-slate-950/60 px-4 py-3">
            <p class="text-xs uppercase tracking-[0.1em] text-slate-500">Latest note</p>
            <p class="mt-1 text-sm text-slate-300/90"><%= truncate(last_note.body, length: 120) %></p>
            <p class="mt-2 text-[0.7rem] uppercase tracking-[0.2em] text-slate-500"><%= last_note.recorded_on.strftime("%b %d • %Y") %></p>
          </div>
        <% end %>
      <% end %>

      <div class="flex justify-end">
        <% tags = chain.dominant_tags %>
        <% if tags.present? %>
          <div class="flex flex-wrap gap-2 text-[0.75rem]">
            <% tags.each do |tag, count| %>
              <span class="rounded-full border border-white/10 px-3 py-1 font-medium text-slate-200/80">
                <%= tag %>
                <span class="text-slate-500">· <%= count %></span>
              </span>
            <% end %>
          </div>
        <% end %>
        <div class="flex items-center gap-2 opacity-0 transition group-hover:opacity-100">
          <%= link_to "Edit", edit_chain_path(chain), data: { turbo_frame: "modal" }, class: "rounded-lg border border-white/10 px-3 py-1 text-xs font-medium text-slate-200/80 hover:border-indigo-400/50 hover:text-white" %>
          <%= button_to "Delete", chain_path(chain), method: :delete, data: { turbo_confirm: "Archive this chain and all its notes?" }, class: "rounded-lg border border-rose-400/40 px-3 py-1 text-xs font-medium text-rose-200/80 hover:bg-rose-500/10" %>
        </div>
      </div>
    </div>
  </article>
<% end %>
