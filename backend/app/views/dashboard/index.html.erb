<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold">JotChain</h1>
    <div class="flex items-center space-x-4">
      <span class="text-sm text-gray-600"><%= Current.user.email_address %></span>
      <%= button_to "Sign Out", session_path, method: :delete, class: "text-sm text-red-600 hover:underline" %>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Main Entry Form -->
    <div class="md:col-span-2">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Today's Entry - <%= Date.current.strftime("%B %d, %Y") %></h2>

        <%= form_with(model: @entry, data: { controller: "prefill-previous" }) do |f| %>
          <% if @entry.errors.any? %>
            <div class="bg-red-50 border border-red-200 rounded p-4 mb-4">
              <%= @entry.errors.full_messages.to_sentence %>
            </div>
          <% end %>

          <%= f.hidden_field :entry_date, value: Date.current %>

          <div class="mb-4">
            <%= f.label :category_id, "Category", class: "block text-sm font-medium mb-2" %>
            <%= f.collection_select :category_id,
                @categories,
                :id,
                :name,
                { include_blank: "Select a category..." },
                class: "w-full px-3 py-2 border rounded-lg" %>
          </div>

          <div class="mb-4">
            <%= f.label :day_log, "What did you accomplish today?", class: "block text-sm font-medium mb-2" %>
            <%= f.text_area :day_log,
                rows: 6,
                class: "w-full px-3 py-2 border rounded-lg",
                placeholder: "Describe what you worked on today...",
                data: { prefill_previous_target: "dayLog" } %>
          </div>

          <div class="mb-4">
            <%= f.label :next_actions, "What's next?", class: "block text-sm font-medium mb-2" %>
            <%= f.text_area :next_actions,
                rows: 6,
                class: "w-full px-3 py-2 border rounded-lg",
                placeholder: "What will you tackle tomorrow?",
                data: { prefill_previous_target: "nextActions" } %>
          </div>

          <div class="mb-6">
            <%= f.label :win, "Today's Win", class: "block text-sm font-medium mb-2" %>
            <%= f.text_area :win,
                rows: 4,
                class: "w-full px-3 py-2 border rounded-lg",
                placeholder: "Celebrate a success from today!",
                data: { prefill_previous_target: "win" } %>
          </div>

          <div>
            <%= f.submit @todays_entry ? "Update Entry" : "Save Entry",
                class: "w-full bg-teal-500 text-white py-2 px-4 rounded-lg hover:bg-teal-600 cursor-pointer" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Categories -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">Categories</h3>
        <%= link_to "Manage Categories", categories_path, class: "text-teal-600 hover:underline text-sm" %>
      </div>

      <!-- Recent Entries -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">Recent Entries</h3>
        <% if @recent_entries.any? %>
          <ul class="space-y-2">
            <% @recent_entries.each do |entry| %>
              <li>
                <%= link_to entry_path(entry), class: "block hover:bg-gray-50 p-2 rounded" do %>
                  <div class="text-sm font-medium"><%= entry.entry_date.strftime("%b %d, %Y") %></div>
                  <div class="text-xs text-gray-600 truncate">
                    <%= truncate(entry.day_log, length: 50) %>
                  </div>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p class="text-sm text-gray-500">No entries yet. Start journaling!</p>
        <% end %>
      </div>
    </div>
  </div>
</div>