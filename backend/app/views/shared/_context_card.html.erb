<%#
  Context Card Partial - JotChain Style

  Parameters:
  - entry: Entry object to display
  - show_latest_badge: Boolean to show "Latest" badge (default: false)
  - content_length: Integer for truncation length (default: 100)
%>

<% show_latest_badge = local_assigns.fetch(:show_latest_badge, false) %>
<% content_length = local_assigns.fetch(:content_length, 100) %>

<div class="bg-card border border-card-border rounded-lg shadow-sm transition-all duration-150 hover:shadow-md">
  <!-- Card Header -->
  <div class="p-6 pb-3">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <h2 class="text-sm font-medium">
          <%= entry.entry_date.strftime("%A, %B %d") %>
        </h2>
        <% if show_latest_badge %>
          <span class="inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors bg-secondary text-secondary-foreground">
            Latest
          </span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Card Content -->
  <div class="px-6 pb-6 pt-0">
    <div class="space-y-4">
      <!-- Done Today Preview -->
      <% if entry.content.present? %>
        <div>
          <h4 class="text-xs font-medium text-muted-foreground mb-2">
            Done Today
          </h4>
          <div class="text-sm text-foreground leading-relaxed">
            <%= truncate(strip_tags(render_markdown(entry.content)), length: content_length) %>
          </div>
        </div>
      <% end %>

      <!-- Next Up Preview -->
      <% if entry.next_actions.present? %>
        <div>
          <h4 class="text-xs font-medium text-muted-foreground mb-2">
            Next Up
          </h4>
          <div class="text-sm text-foreground leading-relaxed">
            <%= truncate(strip_tags(render_markdown(entry.next_actions)), length: content_length) %>
          </div>
        </div>
      <% end %>

      <!-- Win Preview -->
      <% if entry.win_description.present? %>
        <div>
          <h4 class="text-xs font-medium text-muted-foreground mb-2 flex items-center gap-1">
            <%= heroicon "star", variant: :solid, options: { class: "h-3 w-3 text-primary" } %>
            Professional Win
          </h4>
          <div class="text-sm text-foreground leading-relaxed">
            <%= truncate(strip_tags(render_markdown(entry.win_description)), length: content_length) %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
