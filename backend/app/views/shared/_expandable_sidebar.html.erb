<!-- Expandable Right Sidebar -->
<aside data-sidebar-target="calendarSidebar"
       class="fixed right-0 top-0 z-30 h-full bg-white border-l border-border transition-transform duration-150 ease-in-out w-80 lg:w-80 sm:w-72 transform translate-x-full"
       data-sidebar-expanded="false">
  
  <!-- Sidebar Header -->
  <div class="p-4 border-b border-border">
    <div class="flex items-center justify-between mb-4">
      <h2 class="font-semibold text-text-primary">Activity Calendar</h2>
      <button data-action="click->sidebar#toggleCalendar"
              class="p-1 rounded hover:bg-background-secondary transition-colors">
        <svg class="h-4 w-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <!-- Streak Stats -->
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <p class="text-sm text-text-secondary">Current Streak</p>
        <p class="text-2xl font-bold text-text-primary"><%= current_user.current_streak %></p>
      </div>
      <div>
        <p class="text-sm text-text-secondary">Longest Streak</p>
        <p class="text-2xl font-bold text-text-primary"><%= current_user.longest_streak %></p>
      </div>
    </div>
    
    <!-- Interactive Calendar -->
    <div data-controller="calendar"
         data-calendar-streak-data-value="<%= generate_streak_data(current_user).to_json %>"
         class="mb-4">
      <!-- Month Navigation -->
      <div class="flex items-center justify-between mb-4">
        <button data-action="click->calendar#previousMonth"
                class="p-1 rounded hover:bg-background-secondary transition-colors">
          <svg class="h-4 w-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        <span class="font-mono text-sm text-text-primary" data-calendar-target="monthYear">
          <%= Date.current.strftime("%B %Y") %>
        </span>
        <button data-action="click->calendar#nextMonth"
                class="p-1 rounded hover:bg-background-secondary transition-colors">
          <svg class="h-4 w-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
      </div>

      <!-- Calendar Grid -->
      <div data-calendar-target="calendarGrid" class="mb-4">
        <!-- Calendar will be generated by JavaScript -->
      </div>
    </div>

    <!-- Legend -->
    <div class="text-xs text-text-secondary">
      <div class="flex items-center justify-between mb-2">
        <span>Less</span>
        <span>More</span>
      </div>
      <div class="flex gap-1">
        <div class="w-3 h-3 rounded-sm bg-muted"></div>
        <div class="w-3 h-3 rounded-sm bg-primary/20"></div>
        <div class="w-3 h-3 rounded-sm bg-primary/40"></div>
        <div class="w-3 h-3 rounded-sm bg-primary/60"></div>
        <div class="w-3 h-3 rounded-sm bg-primary/80"></div>
        <div class="w-3 h-3 rounded-sm bg-primary"></div>
      </div>
    </div>
  </div>

  <!-- Selected Date Entry -->
  <div class="p-4 border-t border-border">
    <div data-calendar-target="selectedEntry" class="text-sm text-text-secondary">
      Select a date to view entry
    </div>
  </div>
</aside>

<!-- Overlay for mobile sidebar -->
<div data-sidebar-target="calendarOverlay"
     class="hidden fixed inset-0 bg-black/50 z-20 lg:hidden"
     data-action="click->sidebar#closeCalendar"></div>
