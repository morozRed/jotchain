<% content_for :title, "#{@space.name} · JotChain" %>

<section class="space-y-10">
  <header class="rounded-2xl border border-white/10 bg-slate-900/80 p-8 shadow-lg shadow-slate-950/30">
    <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
      <div class="max-w-2xl">
        <p class="text-xs uppercase tracking-[0.35em] text-indigo-200/70">Space Overview</p>
        <h1 class="mt-2 text-4xl font-semibold text-white"><%= @space.name %></h1>
        <p class="mt-3 text-sm leading-6 text-slate-300/90"><%= @space.description.presence || "Add a description so collaborators and AI summaries align on the purpose of this space." %></p>
      </div>
      <div class="grid w-full max-w-sm grid-cols-3 gap-4 rounded-2xl border border-white/10 bg-slate-950/70 p-4 text-center text-xs text-slate-300/70">
        <div>
          <p class="uppercase tracking-[0.35em] text-slate-500">Chains</p>
          <p class="mt-2 text-2xl font-semibold text-white"><%= @space.chains.count %></p>
        </div>
        <div>
          <p class="uppercase tracking-[0.35em] text-slate-500">Notes</p>
          <p class="mt-2 text-2xl font-semibold text-white"><%= @space.links.count %></p>
        </div>
        <div>
          <p class="uppercase tracking-[0.35em] text-slate-500">Last activity</p>
          <% last_link = @space.links.order(recorded_on: :desc).first %>
          <p class="mt-2 text-base font-semibold text-white"><%= last_link&.recorded_on&.strftime("%b %d") || "–" %></p>
        </div>
      </div>
    </div>
  </header>

  <div class="grid gap-6 lg:grid-cols-[minmax(0,1fr)_380px]">
    <div class="space-y-6">
      <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <div>
          <p class="text-xs uppercase tracking-[0.35em] text-indigo-300/70">Chains</p>
          <h2 class="mt-1 text-2xl font-semibold text-white">Threads inside this space</h2>
        </div>
      </div>

      <div id="chains_list" class="space-y-4">
        <% if @chains.any? %>
          <%= render partial: "chains/card", collection: @chains, as: :chain %>
        <% else %>
          <div id="empty_chains_state" class="rounded-xl border border-dashed border-slate-700/70 bg-slate-900/40 p-6 text-sm text-slate-400">
            No chains yet. Click "New Chain" in the sidebar to create your first thread and start logging notes.
          </div>
        <% end %>
      </div>
    </div>

    <aside class="space-y-4">
      <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-5">
        <p class="text-xs uppercase tracking-[0.35em] text-indigo-200/70">Recent activity</p>
        <h2 class="mt-2 text-xl font-semibold text-white">Timeline across chains</h2>
        <p class="mt-2 text-sm text-slate-400">
          Filter by category, tag, or mention to highlight the context you need before we automate summaries.
        </p>

        <%= form_with url: space_path(@space), method: :get, local: true, class: "mt-4 space-y-3 text-sm" do |form| %>
          <div class="grid gap-3">
            <div>
              <%= form.label :category, class: "text-xs font-semibold uppercase tracking-wide text-slate-400" %>
              <%= form.select :category, options_for_select([["All", nil]] + Link.categories.keys.map { |key| [key.titleize, key] }, @link_filters.category), {}, class: "mt-1 block w-full rounded-xl border border-white/10 bg-slate-950/60 px-3 py-2 text-sm text-white focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-400/40" %>
            </div>
            <div>
              <%= form.label :tag, class: "text-xs font-semibold uppercase tracking-wide text-slate-400" %>
              <%= form.text_field :tag, value: @link_filters.tag, placeholder: "e.g. Leadership", class: "mt-1 block w-full rounded-xl border border-white/10 bg-slate-950/60 px-3 py-2 text-sm text-white placeholder:text-slate-500 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-400/40" %>
            </div>
            <div>
              <%= form.label :mention, class: "text-xs font-semibold uppercase tracking-wide text-slate-400" %>
              <%= form.text_field :mention, value: @link_filters.mention, placeholder: "e.g. Andrew Chen", class: "mt-1 block w-full rounded-xl border border-white/10 bg-slate-950/60 px-3 py-2 text-sm text-white placeholder:text-slate-500 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-400/40" %>
            </div>
          </div>
          <div class="flex items-center gap-3 pt-2">
            <%= form.submit "Apply filters", class: "inline-flex flex-1 items-center justify-center rounded-xl bg-indigo-500 px-4 py-2 text-sm font-semibold text-slate-950 shadow-sm hover:bg-indigo-400" %>
            <%= link_to "Reset", space_path(@space), class: "rounded-xl border border-white/10 px-4 py-2 text-sm text-slate-300/80 hover:border-indigo-400/40 hover:text-white" %>
          </div>
        <% end %>
      </div>

      <div class="space-y-4">
        <% @recent_links.each do |link| %>
          <%= render "links/card", link: link %>
        <% end %>

        <% if @recent_links.empty? %>
          <div class="rounded-2xl border border-dashed border-slate-700/80 bg-slate-900/50 p-6 text-sm text-slate-400">
            Notes you capture inside chains will flow here. Start by opening a chain and logging your first link.
          </div>
        <% end %>
      </div>
    </aside>
  </div>
</section>
