<% content_for :title, "#{@space.name} · JotChain" %>
<% content_for :current_space_id, @space.id %>

<section class="space-y-10">
  <header class="rounded-3xl border border-white/10 bg-gradient-to-br from-slate-900/80 via-slate-900/40 to-slate-950/90 p-8">
    <div class="flex flex-col gap-8 lg:flex-row lg:items-start lg:justify-between">
      <!-- Left Column: Space Info & Stats -->
      <div class="flex-1 flex flex-col justify-between">
        <div>
          <p class="text-xs uppercase tracking-[0.35em] text-indigo-200/70">Space Overview</p>
          <div class="mt-2 flex items-center gap-4">
            <h1 class="text-4xl font-semibold text-white"><%= @space.name %></h1>
            <div class="flex items-center gap-3 rounded-full border border-white/10 bg-slate-900/50 px-4 py-1.5 text-sm text-slate-300">
              <span class="flex items-center gap-1.5">
                <svg class="h-4 w-4 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                <span class="font-medium"><%= @space.chains.count %></span>
              </span>
              <span class="text-slate-600">·</span>
              <span class="flex items-center gap-1.5">
                <svg class="h-4 w-4 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="font-medium"><%= @space.links.count %></span>
              </span>
              <span class="text-slate-600">·</span>
              <% last_link = @space.links.order(recorded_on: :desc).first %>
              <% if last_link&.recorded_on %>
                <span class="flex items-center gap-1.5">
                  <svg class="h-4 w-4 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span><%= last_link.recorded_on.strftime("%b %d") %></span>
                </span>
              <% else %>
                <span class="flex items-center gap-1.5">
                  <svg class="h-4 w-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span>No activity</span>
                </span>
              <% end %>
            </div>
          </div>
        </div>
        <p class="mt-4 text-sm leading-6 text-slate-300/90"><%= @space.description.presence || "Add a description so collaborators and AI summaries align on the purpose of this space." %></p>
      </div>

      <!-- Right Column: Filters -->
      <div class="w-full lg:w-auto lg:min-w-[500px]">
        <%= form_with url: space_path(@space), method: :get, local: true, class: "space-y-3" do |form| %>
          <p class="text-xs uppercase tracking-[0.35em] text-indigo-200/70">Filter chains</p>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <%= form.label :search, "Search by name", class: "text-xs font-semibold uppercase tracking-wide text-slate-400" %>
              <%= form.text_field :search, value: params[:search], placeholder: "e.g. Weekly Wins", class: "mt-1 block w-full rounded-xl border border-white/10 bg-slate-950/60 px-3 py-2 text-sm text-white placeholder:text-slate-500 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-400/40" %>
            </div>
            <div>
              <%= form.label :status, "Filter by status", class: "text-xs font-semibold uppercase tracking-wide text-slate-400" %>
              <%= form.select :status, options_for_select([["All", nil], ["Active", "active"], ["Paused", "paused"], ["Archived", "archived"]], params[:status]), {}, class: "mt-1 block w-full rounded-xl border border-white/10 bg-slate-950/60 px-3 py-2 text-sm text-white focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-400/40" %>
            </div>
          </div>

          <div class="flex gap-3">
            <%= form.submit "Apply", class: "flex-1 rounded-xl bg-indigo-500 px-4 py-2 text-sm font-semibold text-slate-950 shadow-sm hover:bg-indigo-400" %>
            <%= link_to "Reset", space_path(@space), class: "rounded-xl border border-white/10 px-4 py-2 text-sm text-slate-300/80 hover:border-indigo-400/40 hover:text-white" %>
          </div>
        <% end %>
      </div>
    </div>
  </header>

  <div class="grid gap-6 lg:grid-cols-[minmax(0,1fr)_380px]">
    <div class="space-y-6">
      <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <div>
          <p class="text-xs uppercase tracking-[0.35em] text-indigo-300/70">Chains</p>
          <h2 class="mt-1 text-2xl font-semibold text-white">Chains inside this space</h2>
        </div>
      </div>

      <div id="chains_list" class="space-y-4">
        <% if @chains.any? %>
          <%= render partial: "chains/card", collection: @chains, as: :chain %>
        <% else %>
          <div id="empty_chains_state" class="rounded-xl border border-dashed border-slate-700/70 bg-slate-900/40 p-6 text-sm text-slate-400">
            No chains yet. Click "New Chain" in the sidebar to create your first thread and start logging notes.
          </div>
        <% end %>
      </div>
    </div>

    <aside class="space-y-4">
      <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-5">
        <p class="text-xs uppercase tracking-[0.35em] text-indigo-200/70">Recent activity</p>
        <h2 class="mt-2 text-xl font-semibold text-white">Timeline across chains</h2>
      </div>

      <div class="space-y-4">
        <% @recent_links.each do |link| %>
          <%= render "links/card", link: link %>
        <% end %>

        <% if @recent_links.empty? %>
          <div class="rounded-2xl border border-dashed border-slate-700/80 bg-slate-900/50 p-6 text-sm text-slate-400">
            Notes you capture inside chains will flow here. Start by opening a chain and logging your first link.
          </div>
        <% end %>
      </div>
    </aside>
  </div>
</section>
