---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog', ({ data }) => !data.draft);
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

const { post } = Astro.props;
const { data } = post;
const { Content } = await post.render();
---

<Layout title={`${data.title} | JotChain Blog`} description={data.description}>
	<Header />

	<div class="page-wrapper">
		<article class="post">
			<header class="post__header fade-in fade-in-1">
				<a href="/blog" class="post__back">← Back to Blog</a>
				<h1>{data.title}</h1>
				<div class="post__meta">
					{data.author && <span class="post__author">By {data.author}</span>}
					<time datetime={data.publishDate.toISOString()}>
						{data.publishDate.toLocaleDateString('en-US', {
							year: 'numeric',
							month: 'long',
							day: 'numeric',
						})}
					</time>
				</div>
				{data.tags && data.tags.length > 0 && (
					<div class="post__tags">
						{data.tags.map((tag) => (
							<span class="tag">{tag}</span>
						))}
					</div>
				)}
			</header>

			<div class="post__content fade-in fade-in-2">
				<Content />
			</div>

			<footer class="post__footer fade-in fade-in-3">
				<a href="/blog" class="post__back">← Back to Blog</a>
			</footer>
		</article>
	</div>

	<Footer />
</Layout>

<style>
	.page-wrapper {
		width: 100%;
		max-width: var(--max-width);
		display: flex;
		flex-direction: column;
		padding: 4rem 0 6rem;
	}

	.post {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	.post__header {
		display: flex;
		flex-direction: column;
		gap: 1rem;
		max-width: var(--content-width);
		margin: 0 auto;
		width: 100%;
	}

	.post__back {
		font-size: 0.9rem;
		color: var(--primary);
		font-weight: 500;
		margin-bottom: 0.5rem;
	}

	.post__back:hover {
		text-decoration: underline;
	}

	.post__header h1 {
		font-size: clamp(1.75rem, 4vw, 2.5rem);
		line-height: 1.2;
	}

	.post__meta {
		display: flex;
		gap: 1rem;
		flex-wrap: wrap;
		color: var(--text-secondary);
		font-size: 0.95rem;
	}

	.post__author {
		font-weight: 500;
	}

	.post__tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}

	.tag {
		padding: 0.25rem 0.6rem;
		border-radius: 999px;
		background: var(--primary-soft-bg);
		color: var(--primary);
		font-size: 0.75rem;
		font-weight: 500;
	}

	.post__content {
		max-width: var(--content-width);
		margin: 0 auto;
		width: 100%;
		color: var(--text-secondary);
		line-height: 1.75;
		font-size: 1.05rem;
	}

	.post__content :global(h2) {
		color: var(--text-primary);
		font-family: var(--font-heading);
		font-size: 1.5rem;
		margin-top: 2.5rem;
		margin-bottom: 1rem;
		font-weight: 600;
	}

	.post__content :global(h3) {
		color: var(--text-primary);
		font-family: var(--font-heading);
		font-size: 1.25rem;
		margin-top: 2rem;
		margin-bottom: 0.75rem;
		font-weight: 600;
	}

	.post__content :global(p) {
		margin-bottom: 1.25rem;
	}

	.post__content :global(ul),
	.post__content :global(ol) {
		margin-bottom: 1.25rem;
		padding-left: 1.5rem;
	}

	.post__content :global(li) {
		margin-bottom: 0.5rem;
	}

	.post__content :global(a) {
		color: var(--primary);
		text-decoration: underline;
	}

	.post__content :global(a:hover) {
		color: var(--primary-hover);
	}

	.post__content :global(code) {
		background: var(--subtle);
		padding: 0.2rem 0.4rem;
		border-radius: 4px;
		font-size: 0.9em;
		font-family: var(--font-heading);
	}

	.post__content :global(pre) {
		background: var(--subtle);
		border: 1px solid var(--border-subtle);
		border-radius: var(--radius);
		padding: 1.5rem;
		overflow-x: auto;
		margin-bottom: 1.25rem;
	}

	.post__content :global(pre code) {
		background: none;
		padding: 0;
	}

	.post__content :global(blockquote) {
		border-left: 3px solid var(--primary);
		padding-left: 1rem;
		margin: 1.5rem 0;
		color: var(--text-primary);
		font-style: italic;
	}

	.post__content :global(img) {
		max-width: 100%;
		border-radius: var(--radius);
		border: 1px solid var(--border);
	}

	.post__content :global(hr) {
		border: none;
		border-top: 1px solid var(--border-subtle);
		margin: 2rem 0;
	}

	.post__footer {
		max-width: var(--content-width);
		margin: 3rem auto 0;
		width: 100%;
		padding-top: 2rem;
		border-top: 1px solid var(--border-subtle);
	}
</style>
