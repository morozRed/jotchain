---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

const allPosts = await getCollection('blog');
const publishedPosts = allPosts
	.filter((post) => !post.data.draft)
	.sort((a, b) => {
		const dateA = a.data.publishDate instanceof Date ? a.data.publishDate : new Date(a.data.publishDate);
		const dateB = b.data.publishDate instanceof Date ? b.data.publishDate : new Date(b.data.publishDate);
		return dateB.getTime() - dateA.getTime();
	});
---

<Layout title="Blog | JotChain" description="Read about work journals, productivity tips, and how teams use JotChain to stay organized and prepared.">
	<div class="shell">
		<Header />

		<section class="hero">
			<h1>Blog</h1>
			<p class="subtitle">
				Read about work journals, productivity tips, and how teams use JotChain to stay organized and prepared.
			</p>
		</section>

		{publishedPosts.length > 0 ? (
			<section class="section posts-grid">
				<div class="posts-list">
					{publishedPosts.map((post) => (
						<article class="post-card">
							<div class="post-card__content">
								<time class="post-card__date" datetime={post.data.publishDate.toISOString()}>
									{post.data.publishDate.toLocaleDateString('en-US', {
										year: 'numeric',
										month: 'long',
										day: 'numeric',
									})}
								</time>
								<h2>
									<a href={`/blog/${post.slug}`}>{post.data.title}</a>
								</h2>
								<p>{post.data.description}</p>
								{post.data.tags && post.data.tags.length > 0 && (
									<div class="post-card__tags">
										{post.data.tags.map((tag) => (
											<span class="tag">{tag}</span>
										))}
									</div>
								)}
							</div>
						</article>
					))}
				</div>
			</section>
		) : (
			<section class="section empty-state">
				<p>No blog posts yet. Check back soon!</p>
			</section>
		)}
	</div>
	<Footer />
</Layout>

<style>
	.shell {
		width: 100%;
		max-width: var(--max-width);
		display: flex;
		flex-direction: column;
		gap: 4rem;
	}

	.hero {
		display: flex;
		flex-direction: column;
		gap: 1.75rem;
		text-align: center;
		align-items: center;
		padding-top: 2rem;
	}

	.hero h1 {
		font-size: clamp(2.5rem, 5vw, 3.6rem);
		line-height: 1.1;
		letter-spacing: -0.03em;
		font-weight: 600;
	}

	.subtitle {
		color: var(--text-secondary);
		font-size: 1.05rem;
		line-height: 1.65;
		max-width: 34rem;
	}

	.section {
		display: flex;
		flex-direction: column;
		gap: 3.5rem;
	}

	.posts-list {
		display: grid;
		gap: 2rem;
		grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
		margin-bottom: 2rem;
	}

	.post-card {
		border-radius: 20px;
		background: rgba(10, 14, 24, 0.82);
		border: 1px solid rgba(148, 163, 184, 0.1);
		overflow: hidden;
		transition: all 0.3s ease;
		display: flex;
		flex-direction: column;
	}

	.post-card:hover {
		background: rgba(13, 18, 28, 0.92);
		border-color: rgba(129, 140, 248, 0.25);
		transform: translateY(-2px);
		box-shadow: 0 12px 32px -16px rgba(129, 140, 248, 0.35);
	}

	.post-card__content {
		padding: 1.8rem;
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
		flex: 1;
	}

	.post-card__date {
		font-size: 0.85rem;
		color: rgba(203, 213, 225, 0.65);
	}

	.post-card h2 {
		font-size: 1.35rem;
		margin: 0;
		line-height: 1.3;
	}

	.post-card h2 a {
		color: var(--text-primary);
		transition: color 0.2s ease;
	}

	.post-card h2 a:hover {
		color: rgba(165, 180, 252, 0.9);
	}

	.post-card p {
		color: var(--text-secondary);
		line-height: 1.6;
		margin: 0;
		font-size: 0.95rem;
		flex: 1;
	}

	.post-card__tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
		margin-top: auto;
		padding-top: 1rem;
	}

	.tag {
		padding: 0.35rem 0.7rem;
		border-radius: 999px;
		background: rgba(148, 163, 184, 0.12);
		color: rgba(203, 213, 225, 0.8);
		font-size: 0.78rem;
	}

	.empty-state {
		text-align: center;
		padding: 4rem 2rem;
		color: var(--text-secondary);
	}

	@media (max-width: 640px) {
		.shell {
			gap: 3rem;
		}

		.hero {
			padding-top: 1rem;
		}

		.posts-list {
			grid-template-columns: 1fr;
		}
	}
</style>

